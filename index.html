<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Suhas Thakral - CV Chatbot</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="header-left">
                    <h1 class="header-title">Suhas Thakral</h1>
                    <p class="header-subtitle">CV Assistant</p>
                </div>
                <div class="header-right">
                    <div class="usage-indicator">
                        <span id="questionCount">5</span> questions remaining
                    </div>
                    <div class="token-indicator">
                        <span id="tokenCount">0</span> tokens used
                    </div>
                    <button id="themeToggle" class="btn btn--secondary theme-toggle" aria-label="Toggle theme">
                        <span class="theme-icon">ðŸŒ™</span>
                    </button>
                </div>
            </div>
        </header>

        <!-- Main Chat Interface -->
        <main class="chat-container">
            <div class="chat-messages" id="chatMessages">
                <div class="message assistant-message welcome-message">
                    <div class="message-content">
                        <div class="message-text">
                            Hello! I'm here to help you learn about Suhas Thakral's professional background. You can ask me about his experience, skills, education, or any other details from his CV. I'll be frank about what information I can or cannot find.
                        </div>
                        <div class="message-time">Now</div>
                    </div>
                </div>
            </div>

            <!-- Smart Suggestions -->
            <div class="suggestions-container">
                <div class="suggestions-header">
                    <div class="suggestions-icon">ðŸ’¡</div>
                    <span class="suggestions-title">Suggested questions</span>
                    <div class="suggestions-loading hidden" id="suggestionsLoading">
                        <div class="loading-dots">
                            <span></span>
                            <span></span>
                            <span></span>
                        </div>
                    </div>
                </div>
                <div class="suggestions-list" id="suggestionsList">
                    <button class="suggestion-btn" data-question="What is Suhas's current role and responsibilities?">
                        What is Suhas's current role and responsibilities?
                    </button>
                    <button class="suggestion-btn" data-question="What are his key technical skills and expertise areas?">
                        What are his key technical skills and expertise areas?
                    </button>
                    <button class="suggestion-btn" data-question="Can you tell me about his major career achievements?">
                        Can you tell me about his major career achievements?
                    </button>
                </div>
            </div>

            <div class="chat-input-container">
                <div class="chat-input-wrapper">
                    <textarea 
                        id="messageInput" 
                        class="form-control chat-input" 
                        placeholder="Ask me about Suhas's experience, skills, or background..."
                        rows="1"
                    ></textarea>
                    <button id="sendButton" class="btn btn--primary send-button">
                        <span class="send-icon">â†’</span>
                    </button>
                </div>
            </div>
        </main>

        <!-- Email Verification Modal -->
        <div id="emailModal" class="modal hidden">
            <div class="modal-backdrop"></div>
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Email Verification Required</h3>
                    <button id="closeModal" class="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <p>You've reached your limit of 5 questions. Please verify your email to get 10 additional questions.</p>
                    <div class="form-group">
                        <label class="form-label" for="emailInput">Email Address</label>
                        <input type="email" id="emailInput" class="form-control" placeholder="your.email@example.com" required>
                    </div>
                    <div class="verification-status hidden" id="verificationStatus">
                        <div class="status status--success">
                            Email verified successfully! You now have 10 additional questions.
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="verifyButton" class="btn btn--primary">Verify Email</button>
                    <button id="cancelButton" class="btn btn--secondary">Cancel</button>
                </div>
            </div>
        </div>

        <!-- Cost Tracking Display -->
        <div class="cost-tracker">
            <div class="cost-info">
                <span class="cost-label">API Cost:</span>
                <span id="currentCost" class="cost-value">$0.00</span>
                <span class="cost-limit">/ $5.00</span>
            </div>
            <div class="session-stats">
                <span class="stats-label">Session:</span>
                <span id="sessionTokens" class="stats-value">0 tokens</span>
                <span class="stats-separator">â€¢</span>
                <span id="sessionCost" class="stats-value">$0.00</span>
            </div>
        </div>

        <!-- Loading Indicator -->
        <div id="loadingIndicator" class="loading-indicator hidden">
            <div class="loading-dots">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
    </div>

    <!-- Required CDN Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <!-- Configuration loader -->
    <script>
        // Token estimation function
        window.estimateTokens = function(text) {
            // Rough estimation: 1 token â‰ˆ 0.75 words for English text
            const words = text.trim().split(/\s+/).length;
            return Math.ceil(words / 0.75);
        };

        // Configuration loader for Vercel deployment
        window.loadConfig = async function() {
            try {
                const response = await fetch('/api/config');
                if (response.ok) {
                    return await response.json();
                }
            } catch (error) {
                console.warn('Config API not available, using fallback mode');
            }

            // Fallback configuration for local development
            return {
                supabaseUrl: null,
                supabaseAnonKey: null,
                hasPerplexityKey: false
            };
        };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="app.js"></script>
</body>
</html>
